<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestione Clienti - Versione Compatibile Mobile</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background-color: #f0f0f0; }
        .container { background-color: white; border: 1px solid #ccc; border-radius: 5px; padding: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        h1 { color: #1e6f9f; margin-top: 0; }
        .input-row { display: flex; flex-direction: column; margin-bottom: 10px; }
        .input-row input, .input-row button { margin-bottom: 5px; padding: 10px; border: 1px solid #ccc; border-radius: 3px; }
        .input-row button { background-color: #1e6f9f; color: white; border: none; cursor: pointer; -webkit-appearance: none; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .delete-btn { background-color: #ff4d4d; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; -webkit-appearance: none; }
        #statusMessage { margin-top: 10px; font-style: italic; }
        #debugInfo { margin-top: 20px; border: 1px solid #ccc; padding: 10px; background-color: #f9f9f9; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Gestione Clienti - Compatibile Mobile</h1>
        <div class="input-row">
            <input type="text" id="nome" placeholder="Nome">
            <input type="text" id="prodotto" placeholder="Prodotto">
            <input type="text" id="citta" placeholder="Città">
            <button id="aggiungiButton">Aggiungi Cliente</button>
        </div>
        <div id="statusMessage"></div>
        <table id="clientiTable">
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Prodotto</th>
                    <th>Città</th>
                    <th>Azione</th>
                </tr>
            </thead>
            <tbody id="clientiBody"></tbody>
        </table>
        <div id="debugInfo"></div>
    </div>

    <script>
        var clienti = [];

        function aggiungiCliente() {
            debugLog("Funzione aggiungiCliente chiamata");
            var nome = document.getElementById('nome').value;
            var prodotto = document.getElementById('prodotto').value;
            var citta = document.getElementById('citta').value;
            
            if (nome && prodotto && citta) {
                clienti.push({nome: nome, prodotto: prodotto, citta: citta});
                aggiornaTabella();
                pulisciCampi();
                salvaDati();
                updateStatus("Cliente aggiunto con successo!");
                debugLog("Cliente aggiunto: " + JSON.stringify({nome: nome, prodotto: prodotto, citta: citta}));
            } else {
                updateStatus("Per favore, compila tutti i campi.");
                debugLog("Campi mancanti: " + JSON.stringify({nome: nome, prodotto: prodotto, citta: citta}));
            }
        }

        function rimuoviCliente(index) {
            debugLog("Rimozione cliente all'indice: " + index);
            clienti.splice(index, 1);
            aggiornaTabella();
            salvaDati();
            updateStatus("Cliente rimosso con successo!");
        }

        function aggiornaTabella() {
            debugLog("Aggiornamento tabella");
            var tbody = document.getElementById('clientiBody');
            tbody.innerHTML = '';
            clienti.forEach(function(cliente, index) {
                var row = tbody.insertRow();
                row.insertCell(0).textContent = cliente.nome;
                row.insertCell(1).textContent = cliente.prodotto;
                row.insertCell(2).textContent = cliente.citta;
                var cellAzione = row.insertCell(3);
                var deleteButton = document.createElement('button');
                deleteButton.textContent = 'Elimina';
                deleteButton.className = 'delete-btn';
                deleteButton.addEventListener('click', function() { rimuoviCliente(index); });
                cellAzione.appendChild(deleteButton);
            });
        }

        function pulisciCampi() {
            document.getElementById('nome').value = '';
            document.getElementById('prodotto').value = '';
            document.getElementById('citta').value = '';
        }

        function updateStatus(message) {
            document.getElementById('statusMessage').textContent = message;
            debugLog("Status aggiornato: " + message);
        }

        function salvaDati() {
            localStorage.setItem('clienti', JSON.stringify(clienti));
            debugLog("Dati salvati in localStorage");
        }

        function caricaDati() {
            var datiSalvati = localStorage.getItem('clienti');
            if (datiSalvati) {
                clienti = JSON.parse(datiSalvati);
                aggiornaTabella();
                debugLog("Dati caricati da localStorage");
            } else {
                debugLog("Nessun dato trovato in localStorage");
            }
        }

        function debugLog(message) {
            console.log(message);
            var debugInfo = document.getElementById('debugInfo');
            debugInfo.innerHTML += message + '<br>';
        }

        function addClickHandler(element, handler) {
            element.addEventListener('click', handler);
            element.addEventListener('touchstart', function(e) {
                e.preventDefault();
                handler(e);
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            debugLog("DOM caricato");
            caricaDati();
            var button = document.getElementById('aggiungiButton');
            if (button) {
                addClickHandler(button, aggiungiCliente);
                debugLog("Event listeners aggiunti al bottone");
            } else {
                debugLog("Bottone non trovato!");
            }
        });
    </script>
</body>
</html>
